include (BundleUtilities)

set ( bundle ${CMAKE_INSTALL_PREFIX}/MantidPlot.app )

file ( GLOB pyqt_libs ${bundle}/Contents/MacOS/PyQt4/*.so )
file ( GLOB_RECURSE qtplugins ${bundle}/Contents/Frameworks/plugins/*.dylib )
file ( GLOB_RECURSE mtdqtplugins ${bundle}/plugins/*.dylib )
set ( mantidpydir ${bundle}/Contents/MacOS/mantid ) 
set ( mantidpy ${mantidpydir}/kernel/_kernel.so
               ${mantidpydir}/kernel/_dlopen.so
               ${mantidpydir}/geometry/_geometry.so
               ${mantidpydir}/api/_api.so )

set ( other_libs ${bundle}/Contents/MacOS/libMantidPythonAPI.so
                 ${bundle}/Contents/MacOS/mantidqtpython.so
                 ${mantidpy} ${pyqt_libs} ${qtplugins} 
                 ${mtdqtplugins}
)

set ( dirs "@CMAKE_LIBRARY_OUTPUT_DIRECTORY@" "@CMAKE_LIBRARY_OUTPUT_DIRECTORY@/mantid/kernel" "@CMAKE_LIBRARY_OUTPUT_DIRECTORY@/mantid/geometry" "@CMAKE_LIBRARY_PATH@" /Library/Frameworks /opt/intel/lib )

fixup_bundle ( "${bundle}" "${other_libs}" "${dirs}" )
