#ifndef PLANE_FUNCTION_BUILDER_TEST_H_
#define PLANE_FUNCTION_BUILDER_TEST_H_

#include <cxxtest/TestSuite.h>
#include <vector>
#include <memory>
#include "PlaneFunctionBuilder.h"
#include "NormalParameter.h"
#include "OriginParameter.h"
#include "InvalidParameter.h"

class PlaneFunctionBuilderTest : public CxxTest::TestSuite
{
public:

    void testCreate()
    {
        using namespace Mantid::MDAlgorithms;
        using namespace Mantid::API;

        PlaneFunctionBuilder builder;
        OriginParameter origin(1, 2, 3);
        builder.addParameter(origin);
        NormalParameter normal(4, 5, 6);
        builder.addParameter(normal);
        std::auto_ptr<IImplicitFunction> impFunc = builder.create();
        PlaneImplicitFunction * planeFunc = dynamic_cast<PlaneImplicitFunction*>(impFunc.get());

        TSM_ASSERT("The function generated by the builder is not a plane function type.", NULL != planeFunc);
        TSM_ASSERT_EQUALS("Origin x value not passed/built in correctly.", 1, planeFunc->getOriginX());
        TSM_ASSERT_EQUALS("Origin y value not passed/built in correctly.", 2, planeFunc->getOriginY());
        TSM_ASSERT_EQUALS("Origin z value not passed/built in correctly.", 3, planeFunc->getOriginZ());
        TSM_ASSERT_EQUALS("Normal x value not passed/built in correctly.", 4, planeFunc->getNormalX());
        TSM_ASSERT_EQUALS("Normal y value not passed/built in correctly.", 5, planeFunc->getNormalY());
        TSM_ASSERT_EQUALS("Normal z value not passed/built in correctly.", 6, planeFunc->getNormalZ());
    }

    void testAddInvalidParameter()
    {
        using namespace Mantid::MDAlgorithms;

        PlaneFunctionBuilder builder;
        InvalidParameter invalid;

        TSM_ASSERT_THROWS("Should have thrown invalid_argument exception as invalid parameter is provided.",  builder.addParameter(invalid), std::invalid_argument );
    }

    void testCreateWithoutNormalThrows()
    {
        using namespace Mantid::MDAlgorithms;

        PlaneFunctionBuilder builder;
        OriginParameter origin(0, 0, 0);
        builder.addParameter(origin);
        TSM_ASSERT_THROWS("Should have thrown invalid_argument exception as normal parameter is missing.",  builder.create(), std::invalid_argument );
    }

    void testCreateWithoutOriginThrows()
    {
        using namespace Mantid::MDAlgorithms;

        PlaneFunctionBuilder builder;
        NormalParameter normal(0, 1, 1);
        builder.addParameter(normal);
        TSM_ASSERT_THROWS("Should have thrown invalid_argument exception as origin parameter is missing.",  builder.create(), std::invalid_argument );
    }

    //If the origin parameter is provided more than once, the latest values should be adopted.
    void testOverwriteOrigin()
    {
        using namespace Mantid::MDAlgorithms;
        using namespace Mantid::API;

        PlaneFunctionBuilder builder;

        OriginParameter origin(1, 2, 3);
        builder.addParameter(origin);

        OriginParameter originOverwrite(4, 5, 6);
        builder.addParameter(originOverwrite);

        builder.addParameter(NormalParameter(0,0,0));
        std::auto_ptr<IImplicitFunction> impFunc = builder.create();
        PlaneImplicitFunction * planeFunc = dynamic_cast<PlaneImplicitFunction*>(impFunc.get());

        TSM_ASSERT_EQUALS("Origin x value not overwritten with newer value.", 4, planeFunc->getOriginX());
        TSM_ASSERT_EQUALS("Origin y value not overwritten with newer value.", 5, planeFunc->getOriginY());
        TSM_ASSERT_EQUALS("Origin z value not overwritten with newer value.", 6, planeFunc->getOriginZ());
    }

    //If the normal parameter is provided more than once, the latest values should be adopted.
    void testOverwiteNormal()
    {
        using namespace Mantid::MDAlgorithms;
        using namespace Mantid::API;

        PlaneFunctionBuilder builder;

        NormalParameter normal(1, 2, 3);
        builder.addParameter(normal);

        NormalParameter normalOverwrite(4, 5, 6);
        builder.addParameter(normalOverwrite);

        builder.addParameter(OriginParameter(0,0,0));
        std::auto_ptr<IImplicitFunction> impFunc = builder.create();
        PlaneImplicitFunction * planeFunc = dynamic_cast<PlaneImplicitFunction*>(impFunc.get());

        TSM_ASSERT("The function generated by the builder is not a plane function type.", NULL != planeFunc);
        TSM_ASSERT_EQUALS("Normal x value not passed/built in correctly.", 4, planeFunc->getNormalX());
        TSM_ASSERT_EQUALS("Normal y value not passed/built in correctly.", 5, planeFunc->getNormalY());
        TSM_ASSERT_EQUALS("Normal z value not passed/built in correctly.", 6, planeFunc->getNormalZ());
    }	
};

#endif