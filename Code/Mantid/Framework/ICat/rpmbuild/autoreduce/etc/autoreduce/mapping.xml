<?xml version="1.0" encoding="ISO-8859-1"?>
<nxingest>
  <name>mapping_muon_v1.1.xml</name>
  <input>NeXus for muon data definition 1 (Direct Creation) </input>
  <version>1.6 </version>
  <version-date>08/10/2007</version-date>
  <version-comment>
                New complex location string. It make the mapping file very dependant
                of the way nxingest is used. The location string now needs nxingest 1.9
                or above to always get '/' as separator.
  </version-comment>
</nxingest>
<icat   type="tbl"   version="1.0 RC6"   xsi:noNamespaceSchemaLocation="icatXSD.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<!-- 
	  == ==========================================-
	  == 	Study Table 
	  == ==========================================-
	  -->
  <study type="tbl">
    <record type="tag">
      <icat_name>name</icat_name>
      <value type="mix">nexus:/entry/title | fix:_ | time:nexus(/entry/start_time) ; 0 ; 6</value>
    </record>
    <record type="tag">
      <icat_name>purpose</icat_name>
      <value type="fix"> Group all Investigation per instrument and per year.</value>
    </record>
    <record type="tag">
      <icat_name> status </icat_name>
      <value type="fix">ONGOING</value>
    </record>
    <record type="tag">
      <icat_name> study_creation_date </icat_name>
      <value type="special">time:now</value>
    </record>

    <investigation type="tbl">
      <record type="tag">
        <icat_name>inv_number</icat_name>
        <value type="nexus">/entry/experiment_identifier</value>
      </record>
      <record type="tag">
        <icat_name>visit_id</icat_name>
        <value type="nexus">/entry/collection_identifier</value>
      </record>
      <record type="tag">
        <icat_name>instrument</icat_name>
        <value type="nexus">/entry/instrument/name.short_name</value>
      </record>
      <record type="tag">
        <icat_name> title </icat_name>
        <value type="nexus">/entry/title</value>
      </record>
                              <!-- 
                        == ==========================================-
                        ==      Investigator Table 
                        == ==========================================-
                        -->
      <investigator type="user_tbl">
        <record type="tag">
          <icat_name>user_id</icat_name>
          <value type="nexus"> /{NXentry}/{NXuser}/facility_user_id </value>
        </record>                               
        <record type="tag">
          <icat_name> affiliation_id </icat_name>
          <value type="nexus"> /{NXentry}/{NXuser}/facility_user_id </value>
        </record>                               
        <record type="tag">
           <icat_name> role </icat_name>
          <value type="nexus"> /{NXentry}/{NXuser}/role  </value>
        </record>                               
      </investigator>
      <record type="tag">
        <icat_name>inv_abstract</icat_name>
      </record>
      <record type="tag">
        <icat_name> inv_type </icat_name>
        <value type="fix">EXPERIMENT</value>
      </record>
      <record type="tag">
        <icat_name>prev_inv_number</icat_name>
      </record>
      <record type="tag">
        <icat_name>bcat_inv_str</icat_name>
        <value type="nexus">/entry/user1/name </value>
      </record>
      <record type="tag">
        <icat_name>grant_id</icat_name>
      </record>
      <record type="tag">
        <icat_name>facility_cycle</icat_name>
      </record>
      <keyword type="keyword_tag">
        <icat_name>name</icat_name>
        <value type="mix">  nexus:/entry/title | fix: , | nexus:/entry/notes </value>
      </keyword>
       <!-- 
                        == ==========================================-
                        ==      Dataset Table 
                        == ==========================================-
                        -->
      <dataset type="tbl">
        <record type="tag">
          <icat_name>name</icat_name>
          <value type="fix">Default</value>
        </record>
        <record type="tag">
          <icat_name>dataset_type</icat_name>
          <value type="fix">EXPERIMENT_RAW</value>
        </record>
        <record type="tag">
          <icat_name>dataset_status</icat_name>
          <value type="fix">COMPLETE</value>
        </record>
        <record type="tag">
          <icat_name> description</icat_name>
          <value type="mix">  fix: Title =  | nexus:/entry/title | fix: , | nexus:/entry/notes </value>
        </record>
        
        <sample type="tbl">
          <record type="tag">
            <icat_name>name</icat_name>
            <value type="mix"> nexus:/entry/sample/name | fix: . </value>
          </record>
          <record type="tag">
            <icat_name>instance</icat_name>
            <value type="fix"> 0 </value>
          </record>
          <record type="tag">
            <icat_name>chemical_formula</icat_name>
            <value type="nexus">/entry/sample/chemical_formula</value>
          </record>
          <record type="tag">
            <icat_name>safety_information</icat_name>
            <value type="fix"> No information available.  </value>
          </record>
                                <!-- 
                                        == ==========================================-
                                        ==      Sample Parameter Table 
                                        == ==========================================-
                                        -->
          <parameter type="param_str">
            <icat_name> sample_changer_position </icat_name>
            <value type="nexus"> /entry/sample/changer_position </value>
          </parameter>
          <parameter type="param_str">
            <icat_name>sample_holder</icat_name>
            <value type="nexus">/entry/sample/holder</value>
          </parameter>
        </sample>
        <datafile type="tbl">
          <record type="tag">
            <icat_name> name </icat_name>
            <value type="special"> sys:filename </value>
          </record>
          <record type="tag">
            <icat_name> location </icat_name>
            <value type="mix"> fix:/SNS/ | nexus:/entry/instrument/name.short_name | fix:/ | nexus:/entry/experiment_identifier | fix:/ | nexus:/entry/collection_identifier | fix:/ | nexus:/entry/run_number | fix:/NeXus | fix:/ | sys:filename </value>
          </record>
          <record type="tag">
            <icat_name> description </icat_name>
            <value type="nexus"> /entry/title </value>
          </record>
          <record type="tag">
            <icat_name> datafile_version </icat_name>
            <value type="fix"> 1.0 </value>
          </record>
          <record type="tag">
            <icat_name> datafile_version_comment </icat_name>
            <value type="fix"> First version </value>
          </record>
          <record type="tag">
            <icat_name> datafile_format </icat_name>
            <value type="fix"> NeXus </value>
          </record>
          <record type="tag">
            <icat_name> datafile_format_version </icat_name>
            <value type="nexus"> /.NeXus_version </value>
          </record>					
          <record type="tag">
            <icat_name> datafile_create_time </icat_name>
            <value type="special"> time:nexus(entry/start_time) ; 0 ; 0 </value>
          </record>
          <record type="tag">
            <icat_name> datafile_modify_time </icat_name>
            <value type="special"> time:nexus(/.file_time) ; 1 ; 0 </value>
          </record>
          <record type="tag">
            <icat_name> file_size </icat_name>
            <value type="special"> sys:size </value>
          </record>					
          <record type="tag">
            <icat_name> command </icat_name>
          </record>
          <record type="tag">
            <icat_name> checksum </icat_name>
          </record>
          <record type="tag">
            <icat_name> signature </icat_name>
          </record>
					<!-- 
						== ==========================================
						== 	Datafile Parameter Table 
						== ==========================================
					-->
          <parameter type="param_num">
            <icat_name> run_number </icat_name>
            <value type="nexus"> /entry/run_number </value>
            <description type="fix"> Run Number</description>
          </parameter>
          <parameter type="param_str">
            <icat_name> nexus_version </icat_name>
            <value type="nexus"> /.NeXus_version </value>
            <description type="fix"> NeXus version used to create the file. </description>
          </parameter>
          <parameter type="param_str">
            <icat_name> hdf_version </icat_name>
            <value type="nexus"> /.HDF_version </value>
            <description type="fix"> HDF Version used to create the file. </description>
          </parameter>
          <parameter type="param_str">
            <icat_name> program_name </icat_name>
            <value type="nexus"> /entry/program_name </value>
            <description type="fix"> Name of creating program. </description>
          </parameter>
          <parameter type="param_str">
            <icat_name> program_version </icat_name>
            <value type="nexus"> /entry/program_name.version </value>
            <description type="fix"> version of creating program. </description>
          </parameter>
          <parameter type="param_str">
            <icat_name> start_date </icat_name>
            <value type="special"> time:nexus(/entry/start_time); 0; 1 </value>
            <units type="fix"> yyyy-MM-dd HH:mm:ss </units>
            <description type="fix"> Start Time of the dataset. </description>
          </parameter>
          <parameter type="param_str">
            <icat_name> finish_date </icat_name>
            <value type="special"> time:nexus(/entry/stop_time); 0; 1 </value>
            <units type="fix"> yyyy-MM-dd HH:mm:ss </units>
            <description type="fix"> Start Time of the dataset. </description>
          </parameter>		
          <parameter type="param_num">
            <icat_name> run_duration </icat_name>
            <value type="nexus"> /entry/duration </value>
            <units type="fix"> seconds </units>"
            <description type="fix"> Calculated duration. </description>
          </parameter>	
          <parameter type="param_str">
            <icat_name> switching_states </icat_name>
            <value type="nexus"> /entry/switching_states</value>
            <description type="fix"> 1 = Normal data collection, 2 = Red/Green mode </description>
          </parameter>
          <parameter type="param_num">
            <icat_name> sample_temperature_setting </icat_name>
            <value type="nexus">/entry/sample/temperature </value>
            <units type="nexus">/entry/sample/temperature.units </units>
            <description type="fix"> Desired temperature</description>
          </parameter>			
          <parameter type="param_num">
            <icat_name> sample_magnetic_field_setting </icat_name>
            <value type="nexus"> /entry/sample/magnetic_field </value>
            <units type="nexus"> /entry/sample/magnetic_field.units </units>
            <description type="fix"> Desired Magnetic field </description>
          </parameter>	
          <parameter type="param_str">
            <icat_name> sample_magnetic_field_state </icat_name>
            <value type="nexus"> /entry/sample/magnetic_field_state </value>
            <description type="fix"> Magnetic field mode, e.g. TF </description>
          </parameter>
          <parameter type="param_str">
            <icat_name> detector_orientation </icat_name>
            <value type="nexus"> /entry/instrument/detector/orientation </value>
            <description type="fix"> Detector arrangement. longitudinal 'l' or Transverse 't' </description>
          </parameter>			    
          <parameter type="param_str">
            <icat_name> collimator_type </icat_name>
            <value type="nexus"> /entry/instrument/collimator/type </value>
            <description type="fix"> Collimator type. e.g. slits </description>
          </parameter>		    
          <parameter type="param_num">
            <icat_name> source_total_count </icat_name>
            <value type="nexus"> /entry/total_counts</value>
            <units type="nexus"> /entry/total_counts.units </units>
            <description type="fix"> Total number of counts. </description>
          </parameter>	 
          <parameter type="param_num">
            <icat_name> source_daereads </icat_name>
            <value type="nexus"> /entry/instrument/beam/daereads </value>
            <description type="fix"> number of readout from the DAE.</description>
          </parameter>	 
          <parameter type="param_num">
            <icat_name> source_frames </icat_name>
            <value type="nexus"> /entry/instrument/beam/frames </value>
            <description type="fix"> ISIS frames collected on each DAE read.</description>
          </parameter>				    
          <parameter type="param_num">
            <icat_name> data_avg_counts </icat_name>
            <value type="nexus"> /entry/histogram_data_1/counts[AVG]</value>
            <units type="nexus"> /entry/histogram_data_1/counts.units </units>
            <description type="fix"> Average of number of counts in histogram_data_1. </description>
          </parameter>
          <parameter type="param_num">
            <icat_name> data_std_counts </icat_name>
            <value type="nexus"> /entry/histogram_data_1/counts[STD]</value>
            <units type="nexus"> /entry/histogram_data_1/counts.units </units>
            <description type="fix"> Standard deviation of number of counts in histogram_data_1. </description>
          </parameter>	
          <parameter type="param_num">
            <icat_name> histogram_resolution </icat_name>
            <value type="nexus"> /entry/histogram_data_1/resolution</value>
            <units type="nexus"> /entry/histogram_data_1/resolution.units </units>
            <description type="fix"> Histogram resolution. set to 0 if not applicable. </description>
          </parameter>				    
          <parameter type="param_num">
            <icat_name> time_zero </icat_name>
            <value type="nexus"> /entry/histogram_data_1/time_zero</value>
            <units type="nexus"> /entry/histogram_data_1/time_zero.units </units>
            <description type="fix"> Time zero for muon measurement. </description>
          </parameter>				    			    
          <parameter type="param_num">
            <icat_name> temperature_avg </icat_name>
            <value type="nexus"> /entry/temperature_log_1/values[AVG]</value>
            <units type="fix"> kelvin </units>
            <description type="mix"> fix: Average of :  | nexus:/entry/temperature_log_1/name </description>
          </parameter>				    
          <parameter type="param_num">
            <icat_name> temperature_std </icat_name>
            <value type="nexus"> /entry/temperature_log_1/values[STD]</value>
            <units type="fix"> kelvin </units>
            <description type="mix"> fix: Standard deviation of :  | nexus:/entry/temperature_log_1/name </description>
          </parameter>	
          <parameter type="param_str">
            <icat_name> bcat_inv_str </icat_name>
            <value type="nexus"> /entry/user/name </value>
          </parameter>
        </datafile>
      </dataset>
    </investigation>
  </study>
</icat>
					
