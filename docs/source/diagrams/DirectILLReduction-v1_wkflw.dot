digraph DirectILLReduction {
  label = "DirectILLReduction workflow diagram"
  $global_style

  subgraph params {
    $param_style
    inputDiagnostics [label="DiagnosticsWorkspace"]
    inputVana [label="IntegratedVanadiumWorkspace"]
    inputWS [label="InputWorkspace"]
    outputWS [label="OutputWorkspace"]
    wRebinParams [label="Energy rebinning settings"]
  }

  subgraph decisions {
    $decision_style
    inputDiagnosticsGiven [label="DiagnosticsWorkspace given?"]
    rebinEnabled [label="Energy rebinning enabled?"]
    chooseVerticalUnits [label="Vertical axis units?"]
  }

  subgraph algorithms {
    $algorithm_style
    ApplyDiagnostics [label="Mask spectra"]
    ConvertSpectrumAxis [label="ConvertSpectrumAxis"]
    ConvertToEnergy [label="Convert TOF to energy transfer"]
    CorrectKiKf [label="CorrectKiKf"]
    DetectorEfficiency [label="DetectorEfficiencyCorUser"]
    GroupDetectors [label="GroupDetectors"]
    Normalize [label="Divide"]
    Rebin [label="Rebin in energy"]
  }

  subgraph values {
  $value_style
  }

  inputWS -> inputDiagnosticsGiven
  inputDiagnosticsGiven -> Normalize [label="no"]
  inputDiagnosticsGiven -> ApplyDiagnostics [label="yes"]
  inputDiagnostics -> ApplyDiagnostics
  ApplyDiagnostics -> Normalize
  inputVana -> Normalize
  Normalize -> ConvertToEnergy
  ConvertToEnergy -> CorrectKiKf
  CorrectKiKf -> DetectorEfficiency
  DetectorEfficiency -> GroupDetectors
  GroupDetectors -> rebinEnabled
  rebinEnabled -> chooseVerticalUnits [label="no"]
  rebinEnabled -> Rebin [label="yes"]
  wRebinParams -> Rebin
  Rebin -> chooseVerticalUnits
  chooseVerticalUnits -> outputWS [label="Spectrum Number"]
  chooseVerticalUnits -> ConvertSpectrumAxis [label="Scattering Angle"]
  ConvertSpectrumAxis -> outputWS
}
