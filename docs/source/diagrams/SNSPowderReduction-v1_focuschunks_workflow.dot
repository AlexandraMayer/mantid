digraph FocusChunks {
  labe="FocusAndSum Flowchart"
  $global_style

  subgraph params {
    $param_style
    RunNumberList
    FilterWall
    CalibrationFile
    SplittersWorkspace
    OutputWorkspacesList
  }

  subgraph algorithms {
    $algorithm_style
    setChunk0 [label="Get a chunk to process"]
    alignAndFocusPowder	[label="AlignAndFocusPowder v1"]
    getRunNumber [label="Get a run number"]
    plus [label="Plus v1\nsummed workspace"]
    load [label="Load v1"]
    split [label="SplitEvents v1"]
    mergeWorkspace [label="Merge chunked workspaces"]
    gatherWorkspace [label="Gather workspaces MPI"]
    compressEvents [label="CompressEvents v1"]
    normaliseByCurrent [label="NormaliseByCurrent v1"]
    plusAmongChunks [label="Plus v1\n workspaces from different chunks but same time range."]
    setGSASParamFile [label="Set GSAS iparam file to run"]
    compressEvents [label="CompressEvents v1"]
    normaliseByCurrent [label="NormaliseByCurrent v1"]
  }

  subgraph decisions{
    $decision_style
    doSplitWorkspace  [label="Do split workspaces?"]

    haveMPI [label="Have MPI?"]
    isSum [label="Is Sum True?"]
    isLastRunNumber [label="Is Last Run Number?"]
    allChunksProcessed [label="Are All Chunks Reduced?"]
  }

  subgraph values {
    $value_style
    RunNumber [label="Run Number"]
  }

  RunNumberList	      -> setChunk0
  setChunk0	      -> load
  load	  	      -> doSplitWorkspace

  doSplitWorkspace	-> splitWorkspace	    [label="Yes"]
  SplittersWorkspace	-> splitWorkspace
  splitWorkspace	-> alignAndFocusPowder

  doSplitWorkspace	-> alignAndFocusPowder  [label="No"]

  alignAndFocusPowder	-> plusAmongChunks
  plusAmongChunks	-> allChunksProcessed

  allChunksProcessed	-> setChunk0  [label="No"]
 
  allChunksProcessed	-> haveMPI [label="Yes"]

  haveMPI	      -> gatherWorkspaces [label="Yes"]
  gatherWorkspaces    -> setGSASParamFile

  haveMPI	      -> setGSASParamFile [label="No"]


  setGSASParamFile    -> compressEvents
  compressEvents      -> normaliseByCurrent
  normaliseByCurrent  -> OutputWorkspacesList



}

