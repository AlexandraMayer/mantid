digraph PowderDiffractionISIS {
  label="Mid-Level PowderDiffractionISIS"
  $global_style

  LoadSac_Start               [label="Load Sac Eff"]
  C_Vana_Start                [label="Create Vana"]
  Focus_one_Start             [label="Start Focusing"]

  subgraph params {
    $param_style

    VEmptyFile
    VanadiumFile

    LoadSac_CorrWorkspace1        [label="Corr Workspace"]
    LoadSac_CorrWorkspace2        [label="Corr Workspace"]
    LoadSac_CorrWorkspace3        [label="Corr Workspace"]
    LoadSac_CorrWorkspace4        [label="Corr Workspace"]
    LoadSac_VanadiumWorkspace     [label="Vanadium Workspace"]
    LoadSac_VanadiumSumWs         [label="VanadiumSum Workspace"]
    LoadSac_SAC_Workspace         [label="SAC Workspace"]
    LoadSac_NewCalFile            [label="GrpOff Cal File"]
    LoadSac_GetProtonCharge       [label="Get Proton Charge"]
    LoadSac_GrpFile_Cal           [label="GrpOff Cal File"]
    LoadSac_Pref_File_Properties  [label="Pref File Properties"]

    C_Vana_VanadiumWorkspace1     [label="Vanadium Workspace"]
    C_Vana_VanadiumWorkspace2     [label="Vanadium Workspace"]
    C_Vana_Corr_Workspace         [label="Corr Workspace"]
    C_Vana_Vanadium_corr_ws1      [label="Vanadium_corr Workspace"]
    C_Vana_Vanadium_corr_ws2      [label="Vanadium_corr Workspace"]
    C_Vana_GrpOff_Cal             [label="GrpOff Cal File"]
    C_Vana_vEmptyWorkspace        [label="VEmpty Workspace"]

    C_Vana_Unstripped_Nexus      [label="(Unstripped) Nexus File"]
    C_Vana_Unstripped_Dat        [label="(Unstripped) Dat File"]

  }

  subgraph processes {
    $process_style

    SacEff_RunGetDataSum      [label="Load Vana (Get Data Sum)"]

    C_Vana_RunCorrectAbs      [label="Van Absorption Correction"]
    C_Vana_RunLoadSacEff1     [label="Load Sac Eff"]
    C_Vana_RunLoadSacEff2     [label="Load Sac Eff (NoSac=true)"]
    C_Vana_RunStripPeaks      [label="Strip Vanadium Peaks"]

    Focus_one_RunGetDataSum   [label="Load Vana (Get Data Sum)"]
    Focus_one_RunCreateVana   [label="Create Vana"]
    Focus_one_RunCorrectAbs   [label="Van Absorption Correction"]

  }

  subgraph algorithms {
    $algorithm_style

    LoadSac_CreateSingle_1                [label="CreateSingleValuedWorkspace"]
    LoadSac_CreateSingle_2                [label="CreateSingleValuedWorkspace"]
    LoadSac_CreateSingle_3                [label="CreateSingleValuedWorkspace"]
    LoadSac_CreateSingle_4                [label="CreateSingleValuedWorkspace"]
    LoadSac_Divide_1                      [label="Divide"]
    LoadSac_Divide_2                      [label="Divide"]
    LoadSac_Integrate_1                   [label="Integrate"]
    LoadSac_Multiply_1                    [label="Multiply"]
    LoadSac_MaskDetectorIf                [label="MaskDetectorIf"]
    LoadSac_SolidAngle                    [label="SolidAngle"]
    LoadSac_Multiply                      [label="Multiply"]
    LoadSac_ConvertUnits                  [label="ConvertUnits"]
    LoadSac_Integration                   [label="Integration"]

    C_Vana_Minus                          [label="Minus"]
    C_Vana_AlignDetectors                 [label="AlignDetectors"]
    C_Vana_Divide                         [label="Divide"]
    C_Vana_DiffractionFocusing            [label="DiffractionFocusing"]
    C_Vana_ReplaceSpecialValues           [label="ReplaceSpecialValues"]
    C_Vana_SaveNexusProcessed             [label="SaveNexusProcessed"]
    C_Vana_SaveFocusedXYE                 [label="SaveFocusedXYE"]

    Focus_one_Integration                 [label="Integration"]
    Focus_one_MaskDetectorIf              [label="MaskDetectorIf"]
    Focus_one_Minus                       [label="Minus"]
    Focus_one_AlignDetectors              [label="AlignDetectors"]
    Focus_one_Divide1                     [label="Divide"]
    Focus_one_Divide2                     [label="Divide"]
    Focus_one_Divide3                     [label="Divide"]
    Focus_one_CreSingleValWS              [label="CreateSingleValuedWorkspace"]
    Focus_one_Multiply                    [label="Multiply"]
    Focus_one_ConvertUnits1               [label="ConvertUnits"]
    Focus_one_ConvertUnits2               [label="ConvertUnits"]
    Focus_one_ConvertUnits3               [label="ConvertUnits"]
    Focus_one_DiffractionFocus            [label="DiffractionFocussing"]
    Focus_one_Rebin                       [label="Rebin"]
    Focus_one_CropWorkspace               [label="CropWorkspace"]
    Focus_one_RebinToWorkspace            [label="RebinToWorkspace"]
    Focus_one_RenameWorkspace             [label="RenameWorkspace"]
    Focus_one_ReplaceSpecValues1          [label="ReplaceSpecialValues"]
    Focus_one_ReplaceSpecValues2          [label="ReplaceSpecialValues"]
    Focus_one_GroupWorkspaces             [label="GroupWorkspaces"]
    Focus_one_SaveGSS                     [label="SaveGSS"]
    Focus_one_SaveNexusProcessed          [label="SaveNexusProcessed"]
    Focus_one_SaveFocusedXYE1             [label="SaveFocusedXYE"]
    Focus_one_SaveFocusedXYE2             [label="SaveFocusedXYE"]

  }

  subgraph decisions {
    $decision_style
    NoSac                             [label="if NoSac"]
    Eff                               [label="if Eff"]
    UampsotalLess                     [label="if Proton Charge < 1e-6"]

    C_Vana_UampsotalGreater           [label="if Proton Charge > 1e-6"]
    C_Vana_NoAbs                      [label="if NoAbs"]

    Focus_one_VGrpFocus               [label="If VGrpFocus is sam"]
    Focus_one_SEmptyFile              [label="If SEmptyFile is not none"]
    Focus_one_CorrectSampleAbs        [label="If CorrectSampleAbs is yes"]
    Focus_one_Norm                    [label="If Normalization required"]

  }

  subgraph load_sac_eff {
  LoadSac_Start                 -> NoSac
  NoSac                         -> LoadSac_CreateSingle_4             [label="true"]
  LoadSac_CreateSingle_4        -> LoadSac_CorrWorkspace4
  NoSac                         -> SacEff_RunGetDataSum               [label="else"]
  SacEff_RunGetDataSum          -> LoadSac_GetProtonCharge
  LoadSac_VanadiumWorkspace     -> LoadSac_GetProtonCharge
  LoadSac_GetProtonCharge       -> UampsotalLess
  UampsotalLess                 -> LoadSac_CreateSingle_1             [label="true"]
  UampsotalLess                 -> LoadSac_Integrate_1                [label="else"]
  LoadSac_CreateSingle_1        -> LoadSac_CorrWorkspace1
  LoadSac_VanadiumWorkspace     -> LoadSac_Integrate_1
  LoadSac_Integrate_1           -> LoadSac_VanadiumSumWs
  LoadSac_Integrate_1           -> LoadSac_MaskDetectorIf
  LoadSac_VanadiumSumWs         -> LoadSac_MaskDetectorIf
  LoadSac_GrpFile_Cal           -> LoadSac_MaskDetectorIf
  LoadSac_MaskDetectorIf        -> LoadSac_NewCalFile
  LoadSac_MaskDetectorIf        -> LoadSac_SolidAngle
  LoadSac_VanadiumWorkspace     -> LoadSac_SolidAngle
  LoadSac_SolidAngle            -> LoadSac_SAC_Workspace
  LoadSac_SolidAngle            -> LoadSac_CreateSingle_2
  LoadSac_CreateSingle_2        -> LoadSac_Multiply
  LoadSac_SAC_Workspace         -> LoadSac_Multiply
  LoadSac_Multiply              -> LoadSac_CorrWorkspace2
  LoadSac_Multiply              -> Eff
  Eff                           -> LoadSac_Divide_1                   [label="true"]
  Eff                           -> LoadSac_CorrWorkspace4             [label="else"]
  LoadSac_VanadiumWorkspace     -> LoadSac_Divide_1
  LoadSac_CorrWorkspace2        -> LoadSac_Divide_1
  LoadSac_Divide_1              -> LoadSac_ConvertUnits
  LoadSac_ConvertUnits          -> LoadSac_Integration
  LoadSac_Pref_File_Properties  -> LoadSac_Integration
  LoadSac_CorrWorkspace2        -> LoadSac_Multiply_1
  LoadSac_Integration           -> LoadSac_Multiply_1
  LoadSac_Multiply_1            -> LoadSac_CreateSingle_3
  LoadSac_Multiply_1            -> LoadSac_CorrWorkspace3
  LoadSac_CreateSingle_3        -> LoadSac_Divide_2
  LoadSac_CorrWorkspace3        -> LoadSac_Divide_2
  LoadSac_Divide_2              -> LoadSac_CorrWorkspace4
// finished
  }

  subgraph create_vana {
// working here
  C_Vana_Start                  -> C_Vana_RunLoadSacEff1
  VanadiumFile                  -> C_Vana_RunLoadSacEff1
  C_Vana_RunLoadSacEff1         -> C_Vana_RunLoadSacEff2
  VEmptyFile                    -> C_Vana_RunLoadSacEff2
  C_Vana_RunLoadSacEff2         -> C_Vana_UampsotalGreater
  C_Vana_UampsotalGreater       -> C_Vana_Minus                         [label="true"]
  C_Vana_VanadiumWorkspace1      -> C_Vana_Minus
  C_Vana_vEmptyWorkspace        -> C_Vana_Minus
  C_Vana_UampsotalGreater       -> C_Vana_AlignDetectors                [label="else"]
  C_Vana_Minus                  -> C_Vana_AlignDetectors
  C_Vana_GrpOff_Cal             -> C_Vana_AlignDetectors
  C_Vana_AlignDetectors         -> C_Vana_Divide
  C_Vana_Corr_Workspace         -> C_Vana_Divide
  C_Vana_Divide                 -> C_Vana_Vanadium_corr_ws1
  C_Vana_Divide                 -> C_Vana_NoAbs
  C_Vana_NoAbs                  -> C_Vana_RunCorrectAbs                 [label="true"]
  C_Vana_Vanadium_corr_ws1      -> C_Vana_RunCorrectAbs
  C_Vana_NoAbs                  -> C_Vana_DiffractionFocusing           [label="else"]
  C_Vana_RunCorrectAbs          -> C_Vana_Vanadium_corr_ws2
  C_Vana_Vanadium_corr_ws2      -> C_Vana_DiffractionFocusing
  C_Vana_RunCorrectAbs          -> C_Vana_DiffractionFocusing
  C_Vana_GrpOff_Cal             -> C_Vana_DiffractionFocusing
  C_Vana_DiffractionFocusing    -> C_Vana_ReplaceSpecialValues
  C_Vana_ReplaceSpecialValues   -> C_Vana_SaveNexusProcessed
  C_Vana_ReplaceSpecialValues   -> C_Vana_VanadiumWorkspace2
  C_Vana_VanadiumWorkspace2     -> C_Vana_SaveNexusProcessed
  C_Vana_SaveNexusProcessed     -> C_Vana_Unstripped_Nexus
  C_Vana_SaveNexusProcessed     -> C_Vana_SaveFocusedXYE
  C_Vana_VanadiumWorkspace2     -> C_Vana_SaveFocusedXYE
  C_Vana_SaveFocusedXYE         -> C_Vana_Unstripped_Dat
  C_Vana_SaveFocusedXYE         -> C_Vana_RunStripPeaks

  }

  subgraph focus_one {
  Focus_one_Start               -> Focus_one_RunGetDataSum
  Focus_one_RunGetDataSum       -> Focus_one_Integration
  Focus_one_Integration         -> Focus_one_MaskDetectorIf
  Focus_one_MaskDetectorIf      -> Focus_one_VGrpFocus
  Focus_one_VGrpFocus           -> Focus_one_RunCreateVana              [label="true"]
  Focus_one_RunCreateVana       -> Focus_one_SEmptyFile
  Focus_one_VGrpFocus           -> Focus_one_SEmptyFile                 [label="else"]
  Focus_one_SEmptyFile          -> Focus_one_Minus                      [label="true"]
  Focus_one_SEmptyFile          -> Focus_one_AlignDetectors             [label="else"]
  Focus_one_Minus               -> Focus_one_AlignDetectors
  Focus_one_AlignDetectors      -> Focus_one_Divide1
  Focus_one_Divide1             -> Focus_one_CreSingleValWS
  Focus_one_CreSingleValWS      -> Focus_one_Multiply
  Focus_one_Multiply            -> Focus_one_CorrectSampleAbs
  Focus_one_CorrectSampleAbs    -> Focus_one_RunCorrectAbs              [label="true"]
  Focus_one_RunCorrectAbs       -> Focus_one_ConvertUnits1
  Focus_one_ConvertUnits1       -> Focus_one_Divide2
  Focus_one_Divide2             -> Focus_one_ConvertUnits2
  Focus_one_ConvertUnits2       -> Focus_one_DiffractionFocus
  Focus_one_CorrectSampleAbs    -> Focus_one_DiffractionFocus           [label="else"]
  Focus_one_DiffractionFocus    -> Focus_one_CropWorkspace
  Focus_one_CropWorkspace       -> Focus_one_Norm
  Focus_one_Norm                -> Focus_one_RebinToWorkspace            [label="true"]
  Focus_one_RebinToWorkspace    -> Focus_one_Divide3
  Focus_one_Norm                -> Focus_one_RenameWorkspace             [label="else"]
  Focus_one_Divide3             -> Focus_one_Rebin
  Focus_one_RenameWorkspace     -> Focus_one_Rebin
  Focus_one_Rebin               -> Focus_one_ConvertUnits3
  Focus_one_ConvertUnits3       -> Focus_one_ReplaceSpecValues1
  Focus_one_ReplaceSpecValues1  -> Focus_one_ReplaceSpecValues2
  Focus_one_ReplaceSpecValues2  -> Focus_one_GroupWorkspaces
  Focus_one_GroupWorkspaces     -> Focus_one_SaveGSS
  Focus_one_SaveGSS             -> Focus_one_SaveNexusProcessed
  Focus_one_SaveNexusProcessed  -> Focus_one_SaveFocusedXYE1
  Focus_one_SaveFocusedXYE1     -> Focus_one_SaveFocusedXYE2

  }

}
