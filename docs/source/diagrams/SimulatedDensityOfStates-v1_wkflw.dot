digraph SimulatedDensityOfStates {
  label="SimulatedDensityOfStates Flowchart"
  $global_style
  
  subgraph params {
    $param_style
	CASTEPFile
	PHONONFile
	Function
	PeakWidth
	SpectrumType
	StickHeight
	Scale
	BinWidth
	Temperature
	ZeroThreshold
	Ions
	SumContributions
	ScaleByCrossSection
	OutputWorkspace
    OutputWorkspace1    [label="OutputWorkspace"]
    OutputWorkspace2    [label="OutputWorkspace"]
    OutputWorkspace3    [label="OutputWorkspace"]
    OutputWorkspace4    [label="OutputWorkspace"]
    OutputWorkspace5    [label="OutputWorkspace"]
    OutputWorkspace6    [label="OutputWorkspace"]
	file_data
    file_data1      [label="file_data"]
    file_data2      [label="file_data"]
    file_data3      [label="file_data"]
    file_data4      [label="file_data"]
	ion_table
	bond_table
	partial_workspaces
	partial_ions
	sum_workspace
  }

  subgraph algorithms {
    $algorithm_style
	CreateEmptyTableWorkspace
	CreateEmptyTableWorkspace1		[label="CreateEmptyTableWorkspace"]
	DeleteWorkspace
	
  }
  
  subgraph decisions {
    $decision_style
	SpectrumType
	sum_contributions 		[label="Sum Contributions"]
  }
  
  subgraph process  {
    $process_style
	read_data_from_file
	convert_to_cartesian_coordinates    [label="convert_to_cartesian_coordinates: Convert fractional coordinates to Cartesian coordinates"]
	compute_partial_ion_workflow

  }
  
  CASTEPFile						->	read_data_from_file
  PHONONFile						->	read_data_from_file
  read_data_from_file				-> 	file_data
  file_data                         ->  SpectrumType
  
  // Ion Table
  SpectrumType						-> 	CreateEmptyTableWorkspace 				[label="IonTable"]
	CreateEmptyTableWorkspace			->	ion_table
    ion_table                           ->  convert_to_cartesian_coordinates
    file_data1                          ->  convert_to_cartesian_coordinates    [label="unit_cell, ions"]
	convert_to_cartesian_coordinates	->	add_ion_data_to_table				[label="Adds the ion data for each ion to the ion_table"]
    add_ion_data_to_table               ->  OutputWorkspace
    
  // Bond Table
  SpectrumType						->  CreateEmptyTableWorkspace1				[label="BondTable"]
	CreateEmptyTableWorkspace1			->	bond_table
	bond_table							->  add_bond_data_to_table				[label="Adds the bond data for each bond to the bond_table"]
    add_bond_data_to_table              ->  OutputWorkspace1
    
  // DOS + calc_partial
  SpectrumType						->	partial_ions							[label="DOS and ions given in input"]
	partial_ions					->	compute_partial_ion_workflow
    file_data2                      ->  compute_partial_ion_workflow
    compute_partial_ion_workflow    ->  sum_contributions                       [label="Outputs partial_workspaces and sum_workspace"]
	sum_contributions				->	sum_workspace							[label="Yes"]
		sum_workspace					-> 	OutputWorkspace2
	sum_contributions				-> 	GroupWorkspaces 						[label="No"]
		partial_workspaces				-> GroupWorkspaces
        GroupWorkspaces					-> 	OutputWorkspace3
        
  // DOS + scale_by_cross_section
  SpectrumType						->	Ions                                    [label="DOS and scale_by_cross_section"]
    Ions	    						->  all_ions                            [label="Convert user input to dictionary"]
    all_ions                            ->  compute_partial_ion_workflow1
    file_data3                          ->  compute_partial_ion_workflow1
    compute_partial_ion_workflow1       ->  partial_workspace1
    compute_partial_ion_workflow1       ->  sum_workspace3
    partial_workspace1                  ->  DeleteWorkspace
    sum_workspace3                      ->  OutputWorkspace4

  // DOS
  SpectrumType						->	compute_DOS								[label="DOS"]
  
  // IR_Active
  SpectrumType						->  ir_intensities							[label="IR_Active"]
  
  //Raman_Active
  SpectrumType						-> 	compute_raman							[label="Raman_Active"]
  
